<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Work - Airports</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Work</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-about">    
        <li>
    <a class="dropdown-item" href="./Boston.html">
 <span class="dropdown-text">Boston</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Airports.html">
 <span class="dropdown-text">Airports</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./Contact.html">
 <span class="menu-text">Contact</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ls5340?tab=repositories"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Airports</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Boston</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Boston.html" class="sidebar-item-text sidebar-link">Boston</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Airports</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Airports.html" class="sidebar-item-text sidebar-link active">Airports</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#new-york-city-flights-data-analysis" id="toc-new-york-city-flights-data-analysis" class="nav-link active" data-scroll-target="#new-york-city-flights-data-analysis">New York City Flights Data Analysis</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#missing-values-ratio" id="toc-missing-values-ratio" class="nav-link" data-scroll-target="#missing-values-ratio">Missing Values Ratio</a></li>
  <li><a href="#low-variance-filter" id="toc-low-variance-filter" class="nav-link" data-scroll-target="#low-variance-filter">Low Variance Filter</a></li>
  <li><a href="#scatterplots" id="toc-scatterplots" class="nav-link" data-scroll-target="#scatterplots">Scatterplots</a>
  <ul class="collapse">
  <li><a href="#scatterplots-using-ggplot" id="toc-scatterplots-using-ggplot" class="nav-link" data-scroll-target="#scatterplots-using-ggplot">Scatterplots using <code>ggplot</code></a></li>
  </ul></li>
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms">Histograms</a>
  <ul class="collapse">
  <li><a href="#histograms-using-ggplot" id="toc-histograms-using-ggplot" class="nav-link" data-scroll-target="#histograms-using-ggplot">Histograms using <code>ggplot</code></a></li>
  </ul></li>
  <li><a href="#boxplots" id="toc-boxplots" class="nav-link" data-scroll-target="#boxplots">Boxplots</a>
  <ul class="collapse">
  <li><a href="#boxplots-using-ggplot" id="toc-boxplots-using-ggplot" class="nav-link" data-scroll-target="#boxplots-using-ggplot">Boxplots using <code>ggplot</code></a></li>
  </ul></li>
  <li><a href="#barplots" id="toc-barplots" class="nav-link" data-scroll-target="#barplots">Barplots</a>
  <ul class="collapse">
  <li><a href="#barplots-using-ggplot" id="toc-barplots-using-ggplot" class="nav-link" data-scroll-target="#barplots-using-ggplot">Barplots using <code>ggplot</code></a></li>
  </ul></li>
  <li><a href="#linegraphs" id="toc-linegraphs" class="nav-link" data-scroll-target="#linegraphs">Linegraphs</a>
  <ul class="collapse">
  <li><a href="#linegraphs-using-ggplot" id="toc-linegraphs-using-ggplot" class="nav-link" data-scroll-target="#linegraphs-using-ggplot">Linegraphs using <code>ggplot</code></a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">Airports</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="new-york-city-flights-data-analysis" class="level1">
<h1>New York City Flights Data Analysis</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#if(!require(nycflights13)){</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  install.packages("nycflights13")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  library(nycflights13)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#} else {</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  library(nycflights13)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>In this post we’ll be usig the <code>nycflights13</code> data again, and this is because it has many other dataframes within it, so that we can use some of dplyr’s relational function.</p>
<p>In fact there are the following datasets within this package:</p>
<ol type="1">
<li><p><code>flights</code> which contains information about all the flights out of New York, and is the most central df</p></li>
<li><p><code>airports</code> which gives us information regarding the airports, ie:the name and location</p></li>
<li><p><code>planes</code> which gives us information regarding particular planes, used in <code>flights</code></p></li>
<li><p><code>airlines</code> gives information regarding airlines</p></li>
<li><p><code>weather</code> which gives us the weather conditions at the departing city/aiport in New York.</p></li>
</ol>
<p>In this post we’ll take a look at <code>flights, planes, and airports</code> in the following 2 questions.</p>
<section id="lets-begin" class="level4">
<h4 class="anchored" data-anchor-id="lets-begin">Let’s begin</h4>
<p>So the first question we’ll take a look at is:</p>
<ul>
<li>Compute the average delay by destination, then join on the airports data frame so you can show the spatial distribution of delays.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 336776     19</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      year          month             day           dep_time    sched_dep_time
 Min.   :2013   Min.   : 1.000   Min.   : 1.00   Min.   :   1   Min.   : 106  
 1st Qu.:2013   1st Qu.: 4.000   1st Qu.: 8.00   1st Qu.: 907   1st Qu.: 906  
 Median :2013   Median : 7.000   Median :16.00   Median :1401   Median :1359  
 Mean   :2013   Mean   : 6.549   Mean   :15.71   Mean   :1349   Mean   :1344  
 3rd Qu.:2013   3rd Qu.:10.000   3rd Qu.:23.00   3rd Qu.:1744   3rd Qu.:1729  
 Max.   :2013   Max.   :12.000   Max.   :31.00   Max.   :2400   Max.   :2359  
                                                 NA's   :8255                 
   dep_delay          arr_time    sched_arr_time   arr_delay       
 Min.   : -43.00   Min.   :   1   Min.   :   1   Min.   : -86.000  
 1st Qu.:  -5.00   1st Qu.:1104   1st Qu.:1124   1st Qu.: -17.000  
 Median :  -2.00   Median :1535   Median :1556   Median :  -5.000  
 Mean   :  12.64   Mean   :1502   Mean   :1536   Mean   :   6.895  
 3rd Qu.:  11.00   3rd Qu.:1940   3rd Qu.:1945   3rd Qu.:  14.000  
 Max.   :1301.00   Max.   :2400   Max.   :2359   Max.   :1272.000  
 NA's   :8255      NA's   :8713                  NA's   :9430      
   carrier              flight       tailnum             origin         
 Length:336776      Min.   :   1   Length:336776      Length:336776     
 Class :character   1st Qu.: 553   Class :character   Class :character  
 Mode  :character   Median :1496   Mode  :character   Mode  :character  
                    Mean   :1972                                        
                    3rd Qu.:3465                                        
                    Max.   :8500                                        
                                                                        
     dest              air_time        distance         hour      
 Length:336776      Min.   : 20.0   Min.   :  17   Min.   : 1.00  
 Class :character   1st Qu.: 82.0   1st Qu.: 502   1st Qu.: 9.00  
 Mode  :character   Median :129.0   Median : 872   Median :13.00  
                    Mean   :150.7   Mean   :1040   Mean   :13.18  
                    3rd Qu.:192.0   3rd Qu.:1389   3rd Qu.:17.00  
                    Max.   :695.0   Max.   :4983   Max.   :23.00  
                    NA's   :9430                                  
     minute        time_hour                     
 Min.   : 0.00   Min.   :2013-01-01 05:00:00.00  
 1st Qu.: 8.00   1st Qu.:2013-04-04 13:00:00.00  
 Median :29.00   Median :2013-07-03 10:00:00.00  
 Mean   :26.23   Mean   :2013-07-03 05:22:54.64  
 3rd Qu.:44.00   3rd Qu.:2013-10-01 07:00:00.00  
 Max.   :59.00   Max.   :2013-12-31 23:00:00.00  
                                                 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [336,776 × 19] (S3: tbl_df/tbl/data.frame)
 $ year          : int [1:336776] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
 $ month         : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
 $ day           : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
 $ dep_time      : int [1:336776] 517 533 542 544 554 554 555 557 557 558 ...
 $ sched_dep_time: int [1:336776] 515 529 540 545 600 558 600 600 600 600 ...
 $ dep_delay     : num [1:336776] 2 4 2 -1 -6 -4 -5 -3 -3 -2 ...
 $ arr_time      : int [1:336776] 830 850 923 1004 812 740 913 709 838 753 ...
 $ sched_arr_time: int [1:336776] 819 830 850 1022 837 728 854 723 846 745 ...
 $ arr_delay     : num [1:336776] 11 20 33 -18 -25 12 19 -14 -8 8 ...
 $ carrier       : chr [1:336776] "UA" "UA" "AA" "B6" ...
 $ flight        : int [1:336776] 1545 1714 1141 725 461 1696 507 5708 79 301 ...
 $ tailnum       : chr [1:336776] "N14228" "N24211" "N619AA" "N804JB" ...
 $ origin        : chr [1:336776] "EWR" "LGA" "JFK" "JFK" ...
 $ dest          : chr [1:336776] "IAH" "IAH" "MIA" "BQN" ...
 $ air_time      : num [1:336776] 227 227 160 183 116 150 158 53 140 138 ...
 $ distance      : num [1:336776] 1400 1416 1089 1576 762 ...
 $ hour          : num [1:336776] 5 5 5 5 6 5 6 6 6 6 ...
 $ minute        : num [1:336776] 15 29 40 45 0 58 0 0 0 0 ...
 $ time_hour     : POSIXct[1:336776], format: "2013-01-01 05:00:00" "2013-01-01 05:00:00" ...</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># category</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(flights<span class="sc">$</span>carrier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "UA" "AA" "B6" "DL" "EV" "MQ" "US" "WN" "VX" "FL" "AS" "9E" "F9" "HA" "YV"
[16] "OO"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of category</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(flights<span class="sc">$</span>carrier))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(flights, class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$year
[1] "integer"

$month
[1] "integer"

$day
[1] "integer"

$dep_time
[1] "integer"

$sched_dep_time
[1] "integer"

$dep_delay
[1] "numeric"

$arr_time
[1] "integer"

$sched_arr_time
[1] "integer"

$arr_delay
[1] "numeric"

$carrier
[1] "character"

$flight
[1] "integer"

$tailnum
[1] "character"

$origin
[1] "character"

$dest
[1] "character"

$air_time
[1] "numeric"

$distance
[1] "numeric"

$hour
[1] "numeric"

$minute
[1] "numeric"

$time_hour
[1] "POSIXct" "POSIXt" </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Alaska <span class="ot">&lt;-</span> flights[flights<span class="sc">$</span>carrier <span class="sc">==</span> <span class="st">"AS"</span>, ]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Alaska, <span class="at">n=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     1     1      724            725        -1     1020           1030
2  2013     1     1     1808           1815        -7     2111           2130
3  2013     1     2      722            725        -3      949           1030
4  2013     1     2     1818           1815         3     2131           2130
5  2013     1     3      724            725        -1     1012           1030
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(Alaska, <span class="at">n=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     9    28     1818           1835       -17     2053           2158
2  2013     9    29      728            720         8     1026           1030
3  2013     9    29     1821           1835       -14     2149           2148
4  2013     9    30      742            720        22     1028           1030
5  2013     9    30     1829           1835        -6     2153           2148
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="missing-values-ratio" class="level2">
<h2 class="anchored" data-anchor-id="missing-values-ratio">Missing Values Ratio</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the missing values ratio for each variable</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>missing_ratio <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(<span class="fu">is.na</span>(flights))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the missing values ratio for each variable</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_ratio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          year          month            day       dep_time sched_dep_time 
   0.000000000    0.000000000    0.000000000    0.024511842    0.000000000 
     dep_delay       arr_time sched_arr_time      arr_delay        carrier 
   0.024511842    0.025871796    0.000000000    0.028000808    0.000000000 
        flight        tailnum         origin           dest       air_time 
   0.000000000    0.007458964    0.000000000    0.000000000    0.028000808 
      distance           hour         minute      time_hour 
   0.000000000    0.000000000    0.000000000    0.000000000 </code></pre>
</div>
</div>
</section>
<section id="low-variance-filter" class="level2">
<h2 class="anchored" data-anchor-id="low-variance-filter">Low Variance Filter</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the required package</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'caret'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    lift</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the Low Variance Filter</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>low_var <span class="ot">&lt;-</span> <span class="fu">nearZeroVar</span>(flights)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the variables with low variance</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(low_var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the name of the variable with low variance</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(flights)[low_var]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "year"</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the required packages</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop non-numeric columns</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>flights_filtered <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the low variance filter</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>low_var <span class="ot">&lt;-</span> <span class="fu">nearZeroVar</span>(flights_filtered, <span class="at">saveMetrics =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify variables with low variance</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>low_var_cols <span class="ot">&lt;-</span> <span class="fu">rownames</span>(low_var)[low_var<span class="sc">$</span>nzv]</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove variables with low variance</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>flights_filtered <span class="ot">&lt;-</span> flights_filtered[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(flights_filtered) <span class="sc">%in%</span> low_var_cols)]</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the filtered dataset</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(flights_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 13
   month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1     1     1      517            515         2      830            819
 2     1     1      533            529         4      850            830
 3     1     1      542            540         2      923            850
 4     1     1      544            545        -1     1004           1022
 5     1     1      554            600        -6      812            837
 6     1     1      554            558        -4      740            728
 7     1     1      555            600        -5      913            854
 8     1     1      557            600        -3      709            723
 9     1     1      557            600        -3      838            846
10     1     1      558            600        -2      753            745
# ℹ 336,766 more rows
# ℹ 6 more variables: arr_delay &lt;dbl&gt;, flight &lt;int&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="scatterplots" class="level2">
<h2 class="anchored" data-anchor-id="scatterplots">Scatterplots</h2>
<p>The first data visualisation technique we introduce is the <strong>Scatterplot</strong> (or bivariate plot), which allows for two variables to be plotted against one another, with one plotted on the x-axis, and the other on the y-axis. This allows us to examine if there is any relationship between the two variables, such as positive or negative correlation, and whether the relationship appears linear or not.</p>
<p>Lets say we wanted to observe the relationship between departure and arrival delays. We can do that in R using the built-in <code>plot()</code> function as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Alaska<span class="sc">$</span>dep_delay, Alaska<span class="sc">$</span>arr_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The $ sign allows us to select specific variables from our <code>New_York</code> data set, such that we have plotted the departure delays (<code>dep_delay</code>) on the x-axis, and arrival delays (<code>arr_delay</code>) on the y-axis. Now, lets start by making the scatterplot clearer by adding more informative axis labels. This can be done as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Alaska<span class="sc">$</span>dep_delay, Alaska<span class="sc">$</span>arr_delay, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Departure delay (minutes)"</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Arrival delay (minutes)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Alaska<span class="sc">$</span>dep_delay, Alaska<span class="sc">$</span>arr_delay, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Departure delay (minutes)"</span>, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Arrival delay (minutes)"</span>, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Alaska Airlines flights leaving NYC in 2013"</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="scatterplots-using-ggplot" class="level3">
<h3 class="anchored" data-anchor-id="scatterplots-using-ggplot">Scatterplots using <code>ggplot</code></h3>
<p>We will now take advantage of the <code>ggplot2</code> library to produce better looking visualisations of our data. First, let us set up the plotting region for our scatterplot of departure against arrival delays as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Alaska, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here, we have set up our plotting region by giving to the <code>ggplot()</code> function:</p>
<ol type="1">
<li><p>The data <code>Alaska</code> by setting <code>data = Alaska</code>.</p></li>
<li><p>The mapping of the coordinates for the axes using <code>aes(x = dep_delay, y = arr_delay)</code>, where <code>aes()</code> relates to the plots aesthetics. That is,</p>
<ul>
<li><p><code>dep_delay</code> maps to the <code>x</code> coordinate; and</p></li>
<li><p><code>arr_delay</code> maps to the <code>y</code> coordinate.</p></li>
</ul></li>
</ol>
<p>In order to include the points on the scatterplot we now need to add an additonal layer using the <code>+</code> command. The points are then added as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Alaska, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay)) <span class="sc">+</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>where <code>geom_point()</code> specifies that the geometric objects to add to our plotting region are points.</p>
<p>When adding layers using <code>ggplot</code> it should be noted that:</p>
<ul>
<li><p>the <code>+</code> command should come at the end of lines, otherwise R will produce and error.</p></li>
<li><p>when adding additional layers it is a good idea to take a new line after each <code>+</code> command. This is so your code will be nice and clear with each layer given its own line of code. This is handy for code debugging.</p></li>
</ul>
<p>We can change the axes labels and include a title on our plot by adding another layer as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Alaska, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Departure delay (minutes)"</span>, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Arrival delay (minutes)"</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Alaska Airlines flights leaving NYC in 2013"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Before moving onto the next section think about the following questions:</p>
<ul>
<li><p>Why do departure and arrival delays appear to have a positive relationship?</p></li>
<li><p>Why is there a cluster of points at (0,0)? What does this indicate?</p></li>
</ul>
<section id="over-plotting" class="level4">
<h4 class="anchored" data-anchor-id="over-plotting">Over-plotting</h4>
<p>From our scatterplot it is clear to see that the vast majority of the points lie close to zero for both departure and arrival delays. This can make it difficult at times to observe what is going on. This is due to so many points being plotted very close to each other, and often plotted over one another in such a way that its impossible to count how many points are actually plotted. This is referred to as <strong>over-plotting</strong>. Using <code>ggplot()</code>, there are two ways we can address this problem:</p>
<ol type="1">
<li><p>adjust the transparancy of the plotted points using the <code>alpha</code> argument.</p></li>
<li><p>jitter the points using the <code>geom_jitter()</code> command.</p></li>
</ol>
<p>We shall first alter the transparancy of the points and see if this improves the situation. This is done as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Alaska, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Departure delay (minutes)"</span>, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Arrival delay (minutes)"</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Alaska Airlines flights leaving NYC in 2013"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The <code>alpha</code> command ranges between 0 and 1, where 0 relates to 100% transparency, while 1 (default) sets the points to be 100% opaque. By changing the transparancy levels of the points we can observe clusters of points that are close to one another as they will be darker than areas of the plot with fewer points clustered together. Try playing around with different levels of <code>alpha</code>.</p>
<p><strong>Jittering</strong> - The idea behind jittering is that each point is randomly moved, or nudged, slightly from its original position in such a way that clusters of points with the same coordinates can be observed, instead of being plotted on top of one another.</p>
</section>
</section>
</section>
<section id="histograms" class="level2">
<h2 class="anchored" data-anchor-id="histograms">Histograms</h2>
<p>Histograms allow us to look at the <em>statistical distribution</em> of a variable. They show us how many values of a variable fall within specified <em>bins</em>. These bins give ranges of values for which the variable lies. The bins can be altered, that is, by changing their width, or by increasing the number of bins, such that we see the distribution at a higher resolution.</p>
<p>Here, lets take a look at the <code>weather</code> data set that is within the <code>nycflights13</code> library. This data set contains hourly weather data from three airports (LGA, JFK and EWR) in New York City in 2013. We can look at its contents via:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(weather, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 15
  origin  year month   day  hour  temp  dewp humid wind_dir wind_speed wind_gust
  &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1 EWR     2013     1     1     1  39.0  26.1  59.4      270      10.4         NA
2 EWR     2013     1     1     2  39.0  27.0  61.6      250       8.06        NA
3 EWR     2013     1     1     3  39.0  28.0  64.4      240      11.5         NA
# ℹ 4 more variables: precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;,
#   time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Now, if we want to look at the distribution of the hourly temperature, we can do that using the <code>hist()</code> function as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(weather<span class="sc">$</span>temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="histograms-using-ggplot" class="level3">
<h3 class="anchored" data-anchor-id="histograms-using-ggplot">Histograms using <code>ggplot</code></h3>
<p>Again, we can create better looking visualisations of our data using <code>ggplot</code>, which also goes for histograms. To create a histogram using <code>ggplot</code> we use the <code>geom_histogram()</code> command, or layer, instead of <code>geom_point()</code> as with scatterplots. We can create a histogram of the hourly temperature data in NYC in 2013 using <code>ggplot</code> as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here, <code>ggplot</code> tells us that it used 30 bins when creating the histogram. It should be noted that the histogram does not look exactly the same as the one we previous created with <code>breaks=30</code>. This is because the algorithm used for specifying the bins is not exactly the same. We can adjust the bins in <code>ggplot</code> using two different approaches. Either by adjusting the</p>
<ul>
<li><p>number of bins using the <code>bins</code> argument; or</p></li>
<li><p>the width of the bins using the <code>binwidth</code> argument.</p></li>
</ul>
<p>Lets first start by specifying the number of bins as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">60</span>, <span class="at">color =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What does changing the number of bins tell us about the distribution of the hourly temperature levels?</p>
<p>Note, we also specified the outline colour of the bins to make it easier to differentiate between them. The colour of the bins themselves can be changed by including the <code>fill</code> argument. The colour options available can be found by typing the following into the R console:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#colors()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Instead of specifying the number of bins, we can specify their width using <code>binwidth</code> as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, we can give the histogram a title and clean up the labels to them more informative:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">60</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (Hourly)"</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Hourly temperatures from NYC in 2013"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(flights, <span class="at">tot_delay =</span> arr_delay <span class="sc">+</span> dep_delay)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_delay =</span> <span class="fu">mean</span>(tot_delay, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports, <span class="fu">c</span>(<span class="st">"dest"</span><span class="ot">=</span><span class="st">"faa"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_delay))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(flights2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  dest  avg_delay name                    lat    lon   alt    tz dst   tzone    
  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    
1 CAE        75.6 Columbia Metropolitan  33.9  -81.1   236    -5 A     America/…
2 TUL        68.5 Tulsa Intl             36.2  -95.9   677    -6 A     America/…
3 OKC        59.8 Will Rogers World      35.4  -97.6  1295    -6 A     America/…
4 JAC        55.6 Jackson Hole Airport   43.6 -111.   6451    -7 A     America/…
5 TYS        52.5 Mc Ghee Tyson          35.8  -84.0   981    -5 A     America/…
6 BHM        45.9 Birmingham Intl        33.6  -86.8   644    -6 A     America/…</code></pre>
</div>
</div>
<p>Before moving on to the next section, think about the following questions:</p>
<ol type="1">
<li><p>How would you describe the distribution of hourly temperature? Is it symmetrical, or skewed?</p></li>
<li><p>What would you say the mean or median hourly temperature is from looking at the histogram?</p></li>
</ol>
</section>
</section>
<section id="boxplots" class="level2">
<h2 class="anchored" data-anchor-id="boxplots">Boxplots</h2>
<p>Another way to look at the distribution of a variable is using a <em>boxplot</em>. A boxplot makes use of the standard <em>five-number summary</em>, that is</p>
<ul>
<li><p>the minimum value;</p></li>
<li><p>the first quartile or 25th percentile;</p></li>
<li><p>the median (or 2nd quartile / 50th percentile);</p></li>
<li><p>the third quartile or 75th percentile;</p></li>
<li><p>and the maximum value.</p></li>
</ul>
<p>Keeping with the hourly temperature data, the five-number summary can be obtained in R using the following command:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weather<span class="sc">$</span>temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  10.94   39.92   55.40   55.26   69.98  100.04       1 </code></pre>
</div>
</div>
<p>This provides us with the five-number summary, as well as the <code>mean</code> hourly temperature. There is one missing value in the hourly temperature data, which is represented in R by <code>NA</code>. What does having similar <code>median</code> and <code>mean</code> values say about the distribution of a variable?</p>
<p>The boxplot of the hourly temperature data can be obtained as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(weather<span class="sc">$</span>temp, <span class="at">ylab =</span> <span class="st">"Hourly Temperature"</span>,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Hourly temperatures from NYC in 2013"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The elements of the boxplot relating to the five-number summary have also been labelled. Other features of the boxplot are:</p>
<ul>
<li><p>the <em>interquartile range (IQR)</em>, that is, the height of the box (3rd - 1st quartiles), and is a measure of the spread of the middle 50% of values. Longer boxes are indicative of greater variability.</p></li>
<li><p>The dashed lines are known as <em>whiskers</em> and represent values less than the 25th percentile, and greater than the 75th percentile, respectively. The longer the whiskers, the more variability there is outside of the middle 50%.</p></li>
</ul>
<p>Boxplots are useful visualisations when comparing the distribution of a numerical variable split across groups (or a <em>categorical variable</em>). For example, we could look at how the hourly temperature changes by month, where month is our categorical, or grouping, variable. This can be done as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(temp <span class="sc">~</span> month, <span class="at">data =</span> weather, <span class="at">ylab =</span> <span class="st">"Hourly Temperature"</span>,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Hourly temperatures from NYC in 2013"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here, we have given to the boxplot function the formula <code>temp ~ month</code>, which basically means we would like boxplots of hourly temperature (<code>temp</code>) separately for each <code>month</code>. Note, we also have to specify that <code>temp</code> and <code>month</code> come from the <code>weather</code> data set. After splitting the hourly temperatures by month, we now see points extending beyond the whiskers of the boxplots. These are known as <em>outliers</em>, and may be thought of as unusually small or large values. However, the definition of an outlier here is somewhat arbitrary as they are defined by the length of the whiskers, which are no more than 1.5 x <em>IQR</em>.</p>
<p>Finally, lets make the boxplot more informative by renaming the labels for each of the boxplots:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(temp <span class="sc">~</span> month, <span class="at">data =</span> weather, <span class="at">ylab =</span> <span class="st">"Hourly Temperature"</span>,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Hourly temperatures from NYC in 2013"</span>, <span class="at">xlab =</span> <span class="st">"Month"</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How does the hourly temperature change throughout the year?</p>
<section id="boxplots-using-ggplot" class="level3">
<h3 class="anchored" data-anchor-id="boxplots-using-ggplot">Boxplots using <code>ggplot</code></h3>
<p>To create boxplots using <code>ggplot</code> we use the <code>geom_boxplot()</code> function. If we want to look at boxplots of a variable separately for a categorical variable then we need to introduce the <code>factor()</code> function. This converts a numerical variable into a categorical one, essentially creating labels or categories from the numeric values. For example, the <code>month</code> variable within the <code>weather</code> data set is a numerical variable taking on the values 1,,12, for each month. However, it makes more sense to convert this into a categorical variable using the <code>factor()</code> function, such that:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#weather$month</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>becomes</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#factor(weather$month)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>with levels, or categories, 1,,12 for each month. Hence, the boxplots can be produced using <code>ggplot</code> as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(month), <span class="at">y =</span> temp)) <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month"</span>, <span class="at">y =</span> <span class="st">"Temperature (Hourly)"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Hourly temperatures from NYC in 2013 by month"</span>)  <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note, we have introduced a new function <code>scale_x_discrete()</code>, which is used to rename the labels of the boxplots. This function is used as our categorical variables are discrete in nature.</p>
<p>Before moving on, consider the following questions:</p>
<ul>
<li><p>Which months have the highest variability in temperature?</p></li>
<li><p>Are there any values that stick out?</p></li>
</ul>
</section>
</section>
<section id="barplots" class="level2">
<h2 class="anchored" data-anchor-id="barplots">Barplots</h2>
<p>Barplots, or barcharts, are used to visualize the distributions of categorical variables. This essentially provides us with the frequencies of categories within a categorical variable. Lets take a look at the distribution of airline carriers within the <code>flights</code> data that flew out of New York City in 2013. We can do this by creating a table containing the number of flights from each airline carrier as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>carrier.freq <span class="ot">&lt;-</span> <span class="fu">table</span>(flights<span class="sc">$</span>carrier)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>carrier.freq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   9E    AA    AS    B6    DL    EV    F9    FL    HA    MQ    OO    UA    US 
18460 32729   714 54635 48110 54173   685  3260   342 26397    32 58665 20536 
   VX    WN    YV 
 5162 12275   601 </code></pre>
</div>
</div>
<p>Turning the above into a barplot provides an easier visualisation of the information provided by the table, and is done as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(carrier.freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note, the names of the airlines relating to the carrier codes can be found by typing <code>airlines</code> into the R console. Using this information and the barplot, find the name of the airline which had the most flights out of New York City in 2013?</p>
<p>Barplots can also be used to compare two categorical variables. For instance, lets say we wanted to look at the number of flights that flew out of New York York in 2013 from each carrier and from each airport (LGA, JFK and EWR). To obtain a table of this information we simply include the flights origin to our previous table as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>carrier.origin <span class="ot">&lt;-</span> <span class="fu">table</span>(flights<span class="sc">$</span>origin, flights<span class="sc">$</span>carrier)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>carrier.origin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     
         9E    AA    AS    B6    DL    EV    F9    FL    HA    MQ    OO    UA
  EWR  1268  3487   714  6557  4342 43939     0     0     0  2276     6 46087
  JFK 14651 13783     0 42076 20701  1408     0     0   342  7193     0  4534
  LGA  2541 15459     0  6002 23067  8826   685  3260     0 16928    26  8044
     
         US    VX    WN    YV
  EWR  4405  1566  6188     0
  JFK  2995  3596     0     0
  LGA 13136     0  6087   601</code></pre>
</div>
</div>
<p>To turn this information into a barplot we use the same method as before:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(carrier.origin, <span class="at">legend.text =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>where the additional argument <code>legend.text=TRUE</code> includes the legend highlighting the three airports. This is what is referred to as a <em>Stacked barplot</em> since the bars for each <code>origin</code> are simply stacked on top of one another for each of the carriers. Which origin did JetBlue Airways appear to favour in 2013?</p>
<section id="barplots-using-ggplot" class="level3">
<h3 class="anchored" data-anchor-id="barplots-using-ggplot">Barplots using <code>ggplot</code></h3>
<p>To create barplots using <code>ggplot</code> we use the <code>geom_col()</code> function. However, as mentioned earlier, <code>ggplot</code> expects the data passed to it to be a data frame, and so we will first transform our previous tables into data frames as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>carrier.freq <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(carrier.freq)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(carrier.freq) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"carrier"</span>, <span class="st">"number"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>carrier.origin <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(carrier.origin)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(carrier.origin) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"origin"</span>, <span class="st">"carrier"</span>, <span class="st">"number"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The names of the columns in our data frames have also been updated using the <code>colnames()</code> function. Take a look at your new data frames within the R console. First, lets plot the data relating to the carriers who flew out of New York City in 2013. This is done using the following code:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> carrier.freq, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> number)) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Add to the code above to give your barplot new labels and a title similar to the one displayed in the notes.</p>
<p>The barplot for comparing two categorical vairables is very similar in this case, where we simply pass the additional <code>fill</code> argument to the <code>aes()</code> function. Including the <code>fill</code> argument lets <code>ggplot</code> plot know that we want to split the barplot according to an additional categorical variable, which is <code>origin</code> in this case. The barplot is then given by:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> carrier.origin, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> number, <span class="at">fill =</span> origin)) <span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Carrier"</span>, <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Carriers who flew out of New York City in 2013"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This provides us with a visually nice barplot to present our carrier information by airport of origin. However, there are also alternative barplots to the stacked barplot. One alternative to a stacked barplot is the <strong>side-by-side</strong> (or <strong>dodged</strong>) <strong>barplot</strong>, which, as suggested by its name, places the bars next to each another instead of on top of one another. This can be produced as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> carrier.origin, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> number, <span class="at">fill =</span> origin)) <span class="sc">+</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Carrier"</span>, <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Carriers who flew out of New York City in 2013"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is done by passing to the <code>geom_col()</code> function the <code>position</code> of the barplots, which in this case is <code>dodged</code>. Before moving on, consider the following two questions:</p>
<ul>
<li><p>What could be considered a positive of using a side-by-side barplot as opposed to a stacked barplot?</p></li>
<li><p>What could be a disadvantage of using a side-by-side barplot?</p></li>
</ul>
<p>Lastly, lets take a look at what is referred to as a <strong>faceted barplot</strong>. They provide an easier way to compare the carrier distributions by origin, and can be obtained as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> carrier.origin, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> number, <span class="at">fill =</span> origin)) <span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> origin, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Carrier"</span>, <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Carriers who flew out of New York City in 2013"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here we include the <code>facet_wrap()</code> function, where we want separate barplots by <code>origin</code>, and hence we use <code>~ origin</code>. We also choose to have them plotted in one column via <code>ncol = 1</code>. This makes it easier to compare their distributions now that they are not stacked on top or beside one another.</p>
<p>Before moving on to the next section, consider the following questions:</p>
<ul>
<li><p>What is the difference between histograms and barplots?</p></li>
<li><p>Why can’t we use histograms to visualize categorical variables?</p></li>
</ul>
</section>
</section>
<section id="linegraphs" class="level2">
<h2 class="anchored" data-anchor-id="linegraphs">Linegraphs</h2>
<p>Linegraphs are typically used when looking at <em>time series</em> data, that is, when we have information on how a variable changes over time. Hence, there is a natural ordering to the data when observing how something changes over time, and therefore, linegraphs should be avoided if there is no sequential ordering of a variable. Lets again look at the hourly temperature data, but this time only for Newark Inernational Airport in January. This can be done by first subsetting the data as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>Newark.Jan <span class="ot">&lt;-</span> weather[weather<span class="sc">$</span>origin <span class="sc">==</span> <span class="st">"EWR"</span> <span class="sc">&amp;</span> weather<span class="sc">$</span>month <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>Newark.Jan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 742 × 15
   origin  year month   day  hour  temp  dewp humid wind_dir wind_speed
   &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1 EWR     2013     1     1     1  39.0  26.1  59.4      270      10.4 
 2 EWR     2013     1     1     2  39.0  27.0  61.6      250       8.06
 3 EWR     2013     1     1     3  39.0  28.0  64.4      240      11.5 
 4 EWR     2013     1     1     4  39.9  28.0  62.2      250      12.7 
 5 EWR     2013     1     1     5  39.0  28.0  64.4      260      12.7 
 6 EWR     2013     1     1     6  37.9  28.0  67.2      240      11.5 
 7 EWR     2013     1     1     7  39.0  28.0  64.4      240      15.0 
 8 EWR     2013     1     1     8  39.9  28.0  62.2      250      10.4 
 9 EWR     2013     1     1     9  39.9  28.0  62.2      260      15.0 
10 EWR     2013     1     1    10  41    28.0  59.6      260      13.8 
# ℹ 732 more rows
# ℹ 5 more variables: wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;, pressure &lt;dbl&gt;,
#   visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p><br>
Take a look at the new data set for hourly temperatures at Newark International Airport in January using functions metioned earlier. We can now produce a linegraph of the hourly temperature as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Newark.Jan<span class="sc">$</span>time_hour, Newark.Jan<span class="sc">$</span>temp, <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time (Hours)"</span>, <span class="at">ylab =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Hourly Temperature at Newark Airport in January 2013"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here, we have passed to the <code>plot()</code> function the additional <code>type=l</code> argument, indicating that we would like a linegraph to be produced. By default, the <code>plot()</code> function plots the data as points. Before moving on, consider the following questions:</p>
<ul>
<li><p>In the code for the linegraph above, why has <code>time_hour</code> been plotted on the x-axis and not <code>hour</code>?</p></li>
<li><p>Why are linegraphs frequently used when time is the explanatory variable?</p></li>
</ul>
<section id="linegraphs-using-ggplot" class="level3">
<h3 class="anchored" data-anchor-id="linegraphs-using-ggplot">Linegraphs using <code>ggplot</code></h3>
<p>To produce linegraphs using <code>ggplot</code> we use the <code>geom_line()</code> command. Hence, our linegraph for the hourly temperatures at Newark International Airport in January 2013 can be created as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Newark.Jan, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> time_hour, <span class="at">y =</span> temp)) <span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time (Hours)"</span>, <span class="at">y =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Hourly Temperature at Newark Airport in January 2013"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Before moving on to the next section, consider the following:</p>
<ul>
<li><p>Why should linegraphs be avoided when there is no sequential ordering of the data?</p></li>
<li><p>Why are linegraphs used when time is the explanatory variable?</p></li>
<li><p>Describe the trend in hourly temperature at Newark International Airport in January 2013.</p></li>
</ul>
<p>Now we’re ready to visualize this information. First let’s make a plot of the United States, as it seems the flights only include flights to other American cities. We use the map data included with the <code>ggplot2</code> package, and we we set the variable <code>states</code> to the dataframe that includes the coordinates to plot each state. We then use <code>geom_polygon</code> in order to plot the map using the coordinate information.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">=</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>states)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> g <span class="sc">+</span> <span class="fu">geom_polygon</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>long,<span class="at">y=</span>lat,<span class="at">group=</span>group),<span class="at">color=</span><span class="st">"white"</span>,<span class="at">fill=</span><span class="st">"grey"</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> g2 <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Map of the USA minus Alaska"</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>g2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s now add the information regarding which destination airports are the cause of most delay. Let’s remove the points that are too west to be plotted onto this map, (ie: all airports in Alaska).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>flights3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights2, lon <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">140</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>g3 <span class="ot">&lt;-</span> g2 <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data=</span>flights3, </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">color =</span> avg_delay), </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">position =</span> <span class="st">"jitter"</span>,<span class="at">size=</span><span class="fl">2.5</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Average Delay"</span>) <span class="sc">+</span> <span class="fu">scale_colour_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>,<span class="at">high =</span> <span class="st">"dark red"</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>g3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s make this even more detailed by adding some labels to the worst, and best destinations.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let's remove the na terms, because they will cause some trouble for the tail function later on.</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#note: probably should've removed the na terms far earlier on.</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>flights3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights3, <span class="sc">!</span><span class="fu">is.na</span>(avg_delay))</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>worst_flights <span class="ot">&lt;-</span> <span class="fu">head</span>(flights3,<span class="dv">5</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>best_flights <span class="ot">&lt;-</span> <span class="fu">tail</span>(flights3,<span class="dv">5</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>g4 <span class="ot">&lt;-</span> g3 <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">data=</span>worst_flights, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">label =</span> dest), <span class="at">color=</span><span class="st">"red"</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.5</span>) </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>g4 <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">data=</span>best_flights, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat , <span class="at">label =</span> dest), <span class="at">angle=</span><span class="dv">20</span>,<span class="at">nudge_y=</span><span class="sc">-</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As an added bonus, we’ll plot this information(including those points too Western for the ggplot map of the USA) using <code>plotly</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#flights2$hover &lt;- with(flights2, paste0(name,', Avg. Delay: '#,avg_delay))</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">#m &lt;- list(</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  colorbar = list(title = "Average Delay"),</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  size = 9, opacity = 0.7, symbol = 'circle'</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="do">## geo styling</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co">#g &lt;- list(</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  scope = 'usa',</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  projection = list(type = 'albers usa'),</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  showland = TRUE,</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  landcolor = toRGB("gray95"),</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co">#  subunitcolor = toRGB("gray85"),</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co">#  countrycolor = toRGB("gray85"),</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  countrywidth = 1,</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="co">#  subunitwidth = 0.5</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a><span class="co">#usa &lt;- plot_ly(flights2, lat = lat, lon = lon, text = hover, color = #avg_delay,</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co">#        type = 'scattergeo', locationmode = 'USA-states', mode = #'markers',</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="co">#        marker = m) %&gt;% layout(title = 'Delays of US airports, #flying out of NYC', geo = g)</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="co">#usa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="second-question-now-is" class="level4">
<h4 class="anchored" data-anchor-id="second-question-now-is">Second Question now is:</h4>
<ul>
<li>Is there a relationship between the age of a plane and its delays?</li>
</ul>
<p>So for this we are using the year the plane is made as a proxy for age, ie: latest models are the youngest planes. Answering this question now requires us to join the <code>planes</code> table with the flights table in a similar fashion as we did before:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>flights_planes <span class="ot">&lt;-</span> <span class="fu">mutate</span>(flights, <span class="at">tot_delay =</span> arr_delay <span class="sc">+</span> dep_delay)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>flights_planes <span class="ot">&lt;-</span> flights_planes <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(tailnum) <span class="sc">%&gt;%</span> </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_delay =</span> <span class="fu">mean</span>(tot_delay, <span class="at">na.rm =</span> T), <span class="at">num_of_flights =</span> <span class="fu">n</span>() ) <span class="sc">%&gt;%</span> </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes, <span class="at">by=</span><span class="st">"tailnum"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_delay))</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(flights_planes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  tailnum avg_delay num_of_flights  year type   manufacturer model engines seats
  &lt;chr&gt;       &lt;dbl&gt;          &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;   &lt;int&gt; &lt;int&gt;
1 N844MH        617              1  2002 Fixed… BOEING       767-…       2   300
2 N911DA        562              1  1995 Fixed… MCDONNELL D… MD-9…       2   142
3 N922EV        550              1  2003 Fixed… BOMBARDIER … CL-6…       2    55
4 N587NW        536              1  2002 Fixed… BOEING       757-…       2   275
5 N851NW        452              1  2004 Fixed… AIRBUS INDU… A330…       2   379
6 N654UA        412              1  1992 Fixed… BOEING       767-…       2   330
# ℹ 2 more variables: speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let's remove all the planes that haven't flown more than 100 times, and any missing values.</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>flights_planes2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights_planes, num_of_flights<span class="sc">&gt;=</span><span class="dv">100</span>, <span class="sc">!</span><span class="fu">is.na</span>(avg_delay), <span class="sc">!</span><span class="fu">is.na</span>(year))</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>g_planes <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>g_planes <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">data=</span>flights_planes2, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>avg_delay)) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">data=</span>flights_planes2, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>avg_delay), <span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Average Delay"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Year of Plane vs Average Delay"</span>) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">data=</span>flights_planes2, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>avg_delay), <span class="at">color=</span><span class="st">"red"</span>, <span class="at">se=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Airports_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the looks of the plot, it doesn’t really seem like there’s a relationship. The average delay times are all fairly spread out for all the years with a lot of planes, there does seem to be a lot more variation in the early 2000s compared to the years following however.</p>
<p>However I plotted the blue line, which represents a linear model (avg_delay ~ year), and it seems to signal a positive relationship between the two variables. We can further examine the model to see if this is valid.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(avg_delay<span class="sc">~</span>year,<span class="at">data=</span>flights_planes2)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = avg_delay ~ year, data = flights_planes2)

Residuals:
    Min      1Q  Median      3Q     Max 
-29.065  -9.303  -1.536   7.916  42.411 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept) -318.72454  139.19931  -2.290   0.0222 *
year           0.16929    0.06954   2.434   0.0151 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 12.73 on 1097 degrees of freedom
Multiple R-squared:  0.005373,  Adjusted R-squared:  0.004466 
F-statistic: 5.926 on 1 and 1097 DF,  p-value: 0.01508</code></pre>
</div>
</div>
<p>We see that the p-value for the coefficient for year is actually significant, and is equal to <code>0.16929</code>, which is again quite negligile in practical terms. In addition, the r-squared of the model is: <code>summary(model)$r.squared</code> which indicates an extremely poor model, and thus it’s evidence against a linear relationship between year of the plane and average delay. In addition we also tried a polynomial model(indicated in red), but that returned a poor r-squared as well. Thus I don’t believe that there’s a practical relationship between the age of the plane the delays they face, at least for the data that is present in the nycflights13 dataset.</p>
</section>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>In this post we used <code>join functions</code> in the <code>dplyr</code> package in order to generate new data frames for our analysis. We were able to use this information to visualize delays by airports via a map of the USA, and we were able to answer the question of whether or not the age of the plane had an influence of the average delay time of the plane.</p>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb84" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Airports"</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="fu"># New York City Flights Data Analysis</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">warning =</span> <span class="cn">FALSE</span>)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a><span class="co">#if(!require(nycflights13)){</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  install.packages("nycflights13")</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="co">#  library(nycflights13)</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a><span class="co">#} else {</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="co">#  library(nycflights13)</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a><span class="fu">### Introduction</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>In this post we'll be usig the <span class="in">`nycflights13`</span> data again, and this is because it has many other dataframes within it, so that we can use some of dplyr's relational function.</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>In fact there are the following datasets within this package:</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`flights`</span> which contains information about all the flights out of New York, and is the most central df</span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`airports`</span> which gives us information regarding the airports, ie:the name and location</span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span><span class="in">`planes`</span> which gives us information regarding particular planes, used in <span class="in">`flights`</span></span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span><span class="in">`airlines`</span> gives information regarding airlines</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span><span class="in">`weather`</span> which gives us the weather conditions at the departing city/aiport in New York.</span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>In this post we'll take a look at <span class="in">`flights, planes, and airports`</span> in the following 2 questions.</span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Let's begin</span></span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>So the first question we'll take a look at is:</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compute the average delay by destination, then join on the airports data frame so you can show the spatial distribution of delays.</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(flights)</span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(flights)</span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(flights)</span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(flights)</span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-71"><a href="#cb84-71" aria-hidden="true" tabindex="-1"></a><span class="co"># category</span></span>
<span id="cb84-72"><a href="#cb84-72" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(flights<span class="sc">$</span>carrier)</span>
<span id="cb84-73"><a href="#cb84-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-74"><a href="#cb84-74" aria-hidden="true" tabindex="-1"></a><span class="co"># number of category</span></span>
<span id="cb84-75"><a href="#cb84-75" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(flights<span class="sc">$</span>carrier))</span>
<span id="cb84-76"><a href="#cb84-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-77"><a href="#cb84-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-80"><a href="#cb84-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-81"><a href="#cb84-81" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(flights, class)</span>
<span id="cb84-82"><a href="#cb84-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-83"><a href="#cb84-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-86"><a href="#cb84-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-87"><a href="#cb84-87" aria-hidden="true" tabindex="-1"></a>Alaska <span class="ot">&lt;-</span> flights[flights<span class="sc">$</span>carrier <span class="sc">==</span> <span class="st">"AS"</span>, ]</span>
<span id="cb84-88"><a href="#cb84-88" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Alaska, <span class="at">n=</span><span class="dv">5</span>)</span>
<span id="cb84-89"><a href="#cb84-89" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(Alaska, <span class="at">n=</span><span class="dv">5</span>)</span>
<span id="cb84-90"><a href="#cb84-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-91"><a href="#cb84-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-92"><a href="#cb84-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## Missing Values Ratio</span></span>
<span id="cb84-93"><a href="#cb84-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-96"><a href="#cb84-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-97"><a href="#cb84-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the missing values ratio for each variable</span></span>
<span id="cb84-98"><a href="#cb84-98" aria-hidden="true" tabindex="-1"></a>missing_ratio <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(<span class="fu">is.na</span>(flights))</span>
<span id="cb84-99"><a href="#cb84-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-100"><a href="#cb84-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the missing values ratio for each variable</span></span>
<span id="cb84-101"><a href="#cb84-101" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_ratio)</span>
<span id="cb84-102"><a href="#cb84-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-103"><a href="#cb84-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-104"><a href="#cb84-104" aria-hidden="true" tabindex="-1"></a><span class="fu">## Low Variance Filter</span></span>
<span id="cb84-105"><a href="#cb84-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-108"><a href="#cb84-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-109"><a href="#cb84-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the required package</span></span>
<span id="cb84-110"><a href="#cb84-110" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb84-111"><a href="#cb84-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-112"><a href="#cb84-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the Low Variance Filter</span></span>
<span id="cb84-113"><a href="#cb84-113" aria-hidden="true" tabindex="-1"></a>low_var <span class="ot">&lt;-</span> <span class="fu">nearZeroVar</span>(flights)</span>
<span id="cb84-114"><a href="#cb84-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-115"><a href="#cb84-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the variables with low variance</span></span>
<span id="cb84-116"><a href="#cb84-116" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(low_var)</span>
<span id="cb84-117"><a href="#cb84-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-118"><a href="#cb84-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the name of the variable with low variance</span></span>
<span id="cb84-119"><a href="#cb84-119" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(flights)[low_var]</span>
<span id="cb84-120"><a href="#cb84-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-121"><a href="#cb84-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-124"><a href="#cb84-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-125"><a href="#cb84-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the required packages</span></span>
<span id="cb84-126"><a href="#cb84-126" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb84-127"><a href="#cb84-127" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb84-128"><a href="#cb84-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-129"><a href="#cb84-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop non-numeric columns</span></span>
<span id="cb84-130"><a href="#cb84-130" aria-hidden="true" tabindex="-1"></a>flights_filtered <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric)</span>
<span id="cb84-131"><a href="#cb84-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-132"><a href="#cb84-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the low variance filter</span></span>
<span id="cb84-133"><a href="#cb84-133" aria-hidden="true" tabindex="-1"></a>low_var <span class="ot">&lt;-</span> <span class="fu">nearZeroVar</span>(flights_filtered, <span class="at">saveMetrics =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-134"><a href="#cb84-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-135"><a href="#cb84-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify variables with low variance</span></span>
<span id="cb84-136"><a href="#cb84-136" aria-hidden="true" tabindex="-1"></a>low_var_cols <span class="ot">&lt;-</span> <span class="fu">rownames</span>(low_var)[low_var<span class="sc">$</span>nzv]</span>
<span id="cb84-137"><a href="#cb84-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-138"><a href="#cb84-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove variables with low variance</span></span>
<span id="cb84-139"><a href="#cb84-139" aria-hidden="true" tabindex="-1"></a>flights_filtered <span class="ot">&lt;-</span> flights_filtered[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(flights_filtered) <span class="sc">%in%</span> low_var_cols)]</span>
<span id="cb84-140"><a href="#cb84-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-141"><a href="#cb84-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the filtered dataset</span></span>
<span id="cb84-142"><a href="#cb84-142" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(flights_filtered)</span>
<span id="cb84-143"><a href="#cb84-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-144"><a href="#cb84-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-145"><a href="#cb84-145" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scatterplots</span></span>
<span id="cb84-146"><a href="#cb84-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-147"><a href="#cb84-147" aria-hidden="true" tabindex="-1"></a>The first data visualisation technique we introduce is the **Scatterplot** (or bivariate plot), which allows for two variables to be plotted against one another, with one plotted on the x-axis, and the other on the y-axis. This allows us to examine if there is any relationship between the two variables, such as positive or negative correlation, and whether the relationship appears linear or not.</span>
<span id="cb84-148"><a href="#cb84-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-149"><a href="#cb84-149" aria-hidden="true" tabindex="-1"></a>Lets say we wanted to observe the relationship between departure and arrival delays. We can do that in R using the built-in <span class="in">`plot()`</span> function as follows:</span>
<span id="cb84-150"><a href="#cb84-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-153"><a href="#cb84-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-154"><a href="#cb84-154" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Alaska<span class="sc">$</span>dep_delay, Alaska<span class="sc">$</span>arr_delay)</span>
<span id="cb84-155"><a href="#cb84-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-156"><a href="#cb84-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-157"><a href="#cb84-157" aria-hidden="true" tabindex="-1"></a>The \$ sign allows us to select specific variables from our <span class="in">`New_York`</span> data set, such that we have plotted the departure delays (<span class="in">`dep_delay`</span>) on the x-axis, and arrival delays (<span class="in">`arr_delay`</span>) on the y-axis. Now, lets start by making the scatterplot clearer by adding more informative axis labels. This can be done as follows:</span>
<span id="cb84-158"><a href="#cb84-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-161"><a href="#cb84-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-162"><a href="#cb84-162" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Alaska<span class="sc">$</span>dep_delay, Alaska<span class="sc">$</span>arr_delay, </span>
<span id="cb84-163"><a href="#cb84-163" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Departure delay (minutes)"</span>, </span>
<span id="cb84-164"><a href="#cb84-164" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Arrival delay (minutes)"</span>)</span>
<span id="cb84-165"><a href="#cb84-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-166"><a href="#cb84-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-169"><a href="#cb84-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-170"><a href="#cb84-170" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Alaska<span class="sc">$</span>dep_delay, Alaska<span class="sc">$</span>arr_delay, </span>
<span id="cb84-171"><a href="#cb84-171" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Departure delay (minutes)"</span>, </span>
<span id="cb84-172"><a href="#cb84-172" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Arrival delay (minutes)"</span>, </span>
<span id="cb84-173"><a href="#cb84-173" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Alaska Airlines flights leaving NYC in 2013"</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb84-174"><a href="#cb84-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-175"><a href="#cb84-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-176"><a href="#cb84-176" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scatterplots using `ggplot`</span></span>
<span id="cb84-177"><a href="#cb84-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-178"><a href="#cb84-178" aria-hidden="true" tabindex="-1"></a>We will now take advantage of the <span class="in">`ggplot2`</span> library to produce better looking visualisations of our data. First, let us set up the plotting region for our scatterplot of departure against arrival delays as follows:</span>
<span id="cb84-179"><a href="#cb84-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-182"><a href="#cb84-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-183"><a href="#cb84-183" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Alaska, </span>
<span id="cb84-184"><a href="#cb84-184" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay))</span>
<span id="cb84-185"><a href="#cb84-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-186"><a href="#cb84-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-187"><a href="#cb84-187" aria-hidden="true" tabindex="-1"></a>Here, we have set up our plotting region by giving to the <span class="in">`ggplot()`</span> function:</span>
<span id="cb84-188"><a href="#cb84-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-189"><a href="#cb84-189" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The data <span class="in">`Alaska`</span> by setting <span class="in">`data = Alaska`</span>.</span>
<span id="cb84-190"><a href="#cb84-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-191"><a href="#cb84-191" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The mapping of the coordinates for the axes using <span class="in">`aes(x = dep_delay, y = arr_delay)`</span>, where <span class="in">`aes()`</span> relates to the plots aesthetics. That is,</span>
<span id="cb84-192"><a href="#cb84-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-193"><a href="#cb84-193" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`dep_delay`</span> maps to the <span class="in">`x`</span> coordinate; and</span>
<span id="cb84-194"><a href="#cb84-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-195"><a href="#cb84-195" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`arr_delay`</span> maps to the <span class="in">`y`</span> coordinate.</span>
<span id="cb84-196"><a href="#cb84-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-197"><a href="#cb84-197" aria-hidden="true" tabindex="-1"></a>In order to include the points on the scatterplot we now need to add an additonal layer using the <span class="in">`+`</span> command. The points are then added as follows:</span>
<span id="cb84-198"><a href="#cb84-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-201"><a href="#cb84-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-202"><a href="#cb84-202" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Alaska, </span>
<span id="cb84-203"><a href="#cb84-203" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay)) <span class="sc">+</span> </span>
<span id="cb84-204"><a href="#cb84-204" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>()</span>
<span id="cb84-205"><a href="#cb84-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-206"><a href="#cb84-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-207"><a href="#cb84-207" aria-hidden="true" tabindex="-1"></a>where <span class="in">`geom_point()`</span> specifies that the geometric objects to add to our plotting region are points.</span>
<span id="cb84-208"><a href="#cb84-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-209"><a href="#cb84-209" aria-hidden="true" tabindex="-1"></a>When adding layers using <span class="in">`ggplot`</span> it should be noted that:</span>
<span id="cb84-210"><a href="#cb84-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-211"><a href="#cb84-211" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the <span class="in">`+`</span> command should come at the end of lines, otherwise R will produce and error.</span>
<span id="cb84-212"><a href="#cb84-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-213"><a href="#cb84-213" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>when adding additional layers it is a good idea to take a new line after each <span class="in">`+`</span> command. This is so your code will be nice and clear with each layer given its own line of code. This is handy for code debugging.</span>
<span id="cb84-214"><a href="#cb84-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-215"><a href="#cb84-215" aria-hidden="true" tabindex="-1"></a>We can change the axes labels and include a title on our plot by adding another layer as follows:</span>
<span id="cb84-216"><a href="#cb84-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-219"><a href="#cb84-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-220"><a href="#cb84-220" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Alaska, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb84-221"><a href="#cb84-221" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Departure delay (minutes)"</span>, </span>
<span id="cb84-222"><a href="#cb84-222" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Arrival delay (minutes)"</span>,</span>
<span id="cb84-223"><a href="#cb84-223" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Alaska Airlines flights leaving NYC in 2013"</span>) </span>
<span id="cb84-224"><a href="#cb84-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-225"><a href="#cb84-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-226"><a href="#cb84-226" aria-hidden="true" tabindex="-1"></a>Before moving onto the next section think about the following questions:</span>
<span id="cb84-227"><a href="#cb84-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-228"><a href="#cb84-228" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why do departure and arrival delays appear to have a positive relationship?</span>
<span id="cb84-229"><a href="#cb84-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-230"><a href="#cb84-230" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why is there a cluster of points at (0,0)? What does this indicate?</span>
<span id="cb84-231"><a href="#cb84-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-232"><a href="#cb84-232" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Over-plotting</span></span>
<span id="cb84-233"><a href="#cb84-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-234"><a href="#cb84-234" aria-hidden="true" tabindex="-1"></a>From our scatterplot it is clear to see that the vast majority of the points lie close to zero for both departure and arrival delays. This can make it difficult at times to observe what is going on. This is due to so many points being plotted very close to each other, and often plotted over one another in such a way that its impossible to count how many points are actually plotted. This is referred to as **over-plotting**. Using <span class="in">`ggplot()`</span>, there are two ways we can address this problem:</span>
<span id="cb84-235"><a href="#cb84-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-236"><a href="#cb84-236" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>adjust the transparancy of the plotted points using the <span class="in">`alpha`</span> argument.</span>
<span id="cb84-237"><a href="#cb84-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-238"><a href="#cb84-238" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>jitter the points using the <span class="in">`geom_jitter()`</span> command.</span>
<span id="cb84-239"><a href="#cb84-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-240"><a href="#cb84-240" aria-hidden="true" tabindex="-1"></a>We shall first alter the transparancy of the points and see if this improves the situation. This is done as follows:</span>
<span id="cb84-241"><a href="#cb84-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-244"><a href="#cb84-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-245"><a href="#cb84-245" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Alaska, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dep_delay, <span class="at">y =</span> arr_delay)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb84-246"><a href="#cb84-246" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Departure delay (minutes)"</span>, </span>
<span id="cb84-247"><a href="#cb84-247" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Arrival delay (minutes)"</span>,</span>
<span id="cb84-248"><a href="#cb84-248" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Alaska Airlines flights leaving NYC in 2013"</span>) </span>
<span id="cb84-249"><a href="#cb84-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-250"><a href="#cb84-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-251"><a href="#cb84-251" aria-hidden="true" tabindex="-1"></a>The <span class="in">`alpha`</span> command ranges between 0 and 1, where 0 relates to 100% transparency, while 1 (default) sets the points to be 100% opaque. By changing the transparancy levels of the points we can observe clusters of points that are close to one another as they will be darker than areas of the plot with fewer points clustered together. Try playing around with different levels of <span class="in">`alpha`</span>.</span>
<span id="cb84-252"><a href="#cb84-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-253"><a href="#cb84-253" aria-hidden="true" tabindex="-1"></a>**Jittering** - The idea behind jittering is that each point is randomly moved, or nudged, slightly from its original position in such a way that clusters of points with the same coordinates can be observed, instead of being plotted on top of one another.</span>
<span id="cb84-254"><a href="#cb84-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-255"><a href="#cb84-255" aria-hidden="true" tabindex="-1"></a><span class="fu">## Histograms</span></span>
<span id="cb84-256"><a href="#cb84-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-257"><a href="#cb84-257" aria-hidden="true" tabindex="-1"></a>Histograms allow us to look at the *statistical distribution* of a variable. They show us how many values of a variable fall within specified *bins*. These bins give ranges of values for which the variable lies. The bins can be altered, that is, by changing their width, or by increasing the number of bins, such that we see the distribution at a higher resolution.</span>
<span id="cb84-258"><a href="#cb84-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-259"><a href="#cb84-259" aria-hidden="true" tabindex="-1"></a>Here, lets take a look at the <span class="in">`weather`</span> data set that is within the <span class="in">`nycflights13`</span> library. This data set contains hourly weather data from three airports (LGA, JFK and EWR) in New York City in 2013. We can look at its contents via:</span>
<span id="cb84-260"><a href="#cb84-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-263"><a href="#cb84-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-264"><a href="#cb84-264" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(weather, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb84-265"><a href="#cb84-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-266"><a href="#cb84-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-267"><a href="#cb84-267" aria-hidden="true" tabindex="-1"></a>Now, if we want to look at the distribution of the hourly temperature, we can do that using the <span class="in">`hist()`</span> function as follows:</span>
<span id="cb84-268"><a href="#cb84-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-271"><a href="#cb84-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-272"><a href="#cb84-272" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(weather<span class="sc">$</span>temp)</span>
<span id="cb84-273"><a href="#cb84-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-274"><a href="#cb84-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-275"><a href="#cb84-275" aria-hidden="true" tabindex="-1"></a><span class="fu">### Histograms using `ggplot`</span></span>
<span id="cb84-276"><a href="#cb84-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-277"><a href="#cb84-277" aria-hidden="true" tabindex="-1"></a>Again, we can create better looking visualisations of our data using <span class="in">`ggplot`</span>, which also goes for histograms. To create a histogram using <span class="in">`ggplot`</span> we use the <span class="in">`geom_histogram()`</span> command, or layer, instead of <span class="in">`geom_point()`</span> as with scatterplots. We can create a histogram of the hourly temperature data in NYC in 2013 using <span class="in">`ggplot`</span> as follows:</span>
<span id="cb84-278"><a href="#cb84-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-281"><a href="#cb84-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-282"><a href="#cb84-282" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb84-283"><a href="#cb84-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb84-284"><a href="#cb84-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-285"><a href="#cb84-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-286"><a href="#cb84-286" aria-hidden="true" tabindex="-1"></a>Here, <span class="in">`ggplot`</span> tells us that it used 30 bins when creating the histogram. It should be noted that the histogram does not look exactly the same as the one we previous created with <span class="in">`breaks=30`</span>. This is because the algorithm used for specifying the bins is not exactly the same. We can adjust the bins in <span class="in">`ggplot`</span> using two different approaches. Either by adjusting the</span>
<span id="cb84-287"><a href="#cb84-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-288"><a href="#cb84-288" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>number of bins using the <span class="in">`bins`</span> argument; or</span>
<span id="cb84-289"><a href="#cb84-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-290"><a href="#cb84-290" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the width of the bins using the <span class="in">`binwidth`</span> argument.</span>
<span id="cb84-291"><a href="#cb84-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-292"><a href="#cb84-292" aria-hidden="true" tabindex="-1"></a>Lets first start by specifying the number of bins as follows:</span>
<span id="cb84-293"><a href="#cb84-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-296"><a href="#cb84-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-297"><a href="#cb84-297" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb84-298"><a href="#cb84-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">60</span>, <span class="at">color =</span> <span class="st">"white"</span>)</span>
<span id="cb84-299"><a href="#cb84-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-300"><a href="#cb84-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-301"><a href="#cb84-301" aria-hidden="true" tabindex="-1"></a>What does changing the number of bins tell us about the distribution of the hourly temperature levels?</span>
<span id="cb84-302"><a href="#cb84-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-303"><a href="#cb84-303" aria-hidden="true" tabindex="-1"></a>Note, we also specified the outline colour of the bins to make it easier to differentiate between them. The colour of the bins themselves can be changed by including the <span class="in">`fill`</span> argument. The colour options available can be found by typing the following into the R console:</span>
<span id="cb84-304"><a href="#cb84-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-307"><a href="#cb84-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-308"><a href="#cb84-308" aria-hidden="true" tabindex="-1"></a><span class="co">#colors()</span></span>
<span id="cb84-309"><a href="#cb84-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-310"><a href="#cb84-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-311"><a href="#cb84-311" aria-hidden="true" tabindex="-1"></a>Instead of specifying the number of bins, we can specify their width using <span class="in">`binwidth`</span> as follows:</span>
<span id="cb84-312"><a href="#cb84-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-315"><a href="#cb84-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-316"><a href="#cb84-316" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb84-317"><a href="#cb84-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"white"</span>)</span>
<span id="cb84-318"><a href="#cb84-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-319"><a href="#cb84-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-320"><a href="#cb84-320" aria-hidden="true" tabindex="-1"></a>Finally, we can give the histogram a title and clean up the labels to them more informative:</span>
<span id="cb84-321"><a href="#cb84-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-324"><a href="#cb84-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-325"><a href="#cb84-325" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb84-326"><a href="#cb84-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">60</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb84-327"><a href="#cb84-327" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (Hourly)"</span>,</span>
<span id="cb84-328"><a href="#cb84-328" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Hourly temperatures from NYC in 2013"</span>) </span>
<span id="cb84-329"><a href="#cb84-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-330"><a href="#cb84-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-333"><a href="#cb84-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-334"><a href="#cb84-334" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(flights, <span class="at">tot_delay =</span> arr_delay <span class="sc">+</span> dep_delay)</span>
<span id="cb84-335"><a href="#cb84-335" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span> </span>
<span id="cb84-336"><a href="#cb84-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_delay =</span> <span class="fu">mean</span>(tot_delay, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-337"><a href="#cb84-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports, <span class="fu">c</span>(<span class="st">"dest"</span><span class="ot">=</span><span class="st">"faa"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb84-338"><a href="#cb84-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_delay))</span>
<span id="cb84-339"><a href="#cb84-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-340"><a href="#cb84-340" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(flights2)</span>
<span id="cb84-341"><a href="#cb84-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-342"><a href="#cb84-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-343"><a href="#cb84-343" aria-hidden="true" tabindex="-1"></a>Before moving on to the next section, think about the following questions:</span>
<span id="cb84-344"><a href="#cb84-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-345"><a href="#cb84-345" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>How would you describe the distribution of hourly temperature? Is it symmetrical, or skewed?</span>
<span id="cb84-346"><a href="#cb84-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-347"><a href="#cb84-347" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>What would you say the mean or median hourly temperature is from looking at the histogram?</span>
<span id="cb84-348"><a href="#cb84-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-349"><a href="#cb84-349" aria-hidden="true" tabindex="-1"></a><span class="fu">## Boxplots</span></span>
<span id="cb84-350"><a href="#cb84-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-351"><a href="#cb84-351" aria-hidden="true" tabindex="-1"></a>Another way to look at the distribution of a variable is using a *boxplot*. A boxplot makes use of the standard *five-number summary*, that is</span>
<span id="cb84-352"><a href="#cb84-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-353"><a href="#cb84-353" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the minimum value;</span>
<span id="cb84-354"><a href="#cb84-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-355"><a href="#cb84-355" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the first quartile or 25th percentile;</span>
<span id="cb84-356"><a href="#cb84-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-357"><a href="#cb84-357" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the median (or 2nd quartile / 50th percentile);</span>
<span id="cb84-358"><a href="#cb84-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-359"><a href="#cb84-359" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the third quartile or 75th percentile;</span>
<span id="cb84-360"><a href="#cb84-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-361"><a href="#cb84-361" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>and the maximum value.</span>
<span id="cb84-362"><a href="#cb84-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-363"><a href="#cb84-363" aria-hidden="true" tabindex="-1"></a>Keeping with the hourly temperature data, the five-number summary can be obtained in R using the following command:</span>
<span id="cb84-364"><a href="#cb84-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-367"><a href="#cb84-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-368"><a href="#cb84-368" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weather<span class="sc">$</span>temp)</span>
<span id="cb84-369"><a href="#cb84-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-370"><a href="#cb84-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-371"><a href="#cb84-371" aria-hidden="true" tabindex="-1"></a>This provides us with the five-number summary, as well as the <span class="in">`mean`</span> hourly temperature. There is one missing value in the hourly temperature data, which is represented in R by <span class="in">`NA`</span>. What does having similar <span class="in">`median`</span> and <span class="in">`mean`</span> values say about the distribution of a variable?</span>
<span id="cb84-372"><a href="#cb84-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-373"><a href="#cb84-373" aria-hidden="true" tabindex="-1"></a>The boxplot of the hourly temperature data can be obtained as follows:</span>
<span id="cb84-374"><a href="#cb84-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-377"><a href="#cb84-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-378"><a href="#cb84-378" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(weather<span class="sc">$</span>temp, <span class="at">ylab =</span> <span class="st">"Hourly Temperature"</span>,</span>
<span id="cb84-379"><a href="#cb84-379" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Hourly temperatures from NYC in 2013"</span>)</span>
<span id="cb84-380"><a href="#cb84-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-381"><a href="#cb84-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-382"><a href="#cb84-382" aria-hidden="true" tabindex="-1"></a>The elements of the boxplot relating to the five-number summary have also been labelled. Other features of the boxplot are:</span>
<span id="cb84-383"><a href="#cb84-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-384"><a href="#cb84-384" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the *interquartile range (IQR)*, that is, the height of the box (3rd - 1st quartiles), and is a measure of the spread of the middle 50% of values. Longer boxes are indicative of greater variability.</span>
<span id="cb84-385"><a href="#cb84-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-386"><a href="#cb84-386" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The dashed lines are known as *whiskers* and represent values less than the 25th percentile, and greater than the 75th percentile, respectively. The longer the whiskers, the more variability there is outside of the middle 50%.</span>
<span id="cb84-387"><a href="#cb84-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-388"><a href="#cb84-388" aria-hidden="true" tabindex="-1"></a>Boxplots are useful visualisations when comparing the distribution of a numerical variable split across groups (or a *categorical variable*). For example, we could look at how the hourly temperature changes by month, where month is our categorical, or grouping, variable. This can be done as follows:</span>
<span id="cb84-389"><a href="#cb84-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-392"><a href="#cb84-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-393"><a href="#cb84-393" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(temp <span class="sc">~</span> month, <span class="at">data =</span> weather, <span class="at">ylab =</span> <span class="st">"Hourly Temperature"</span>,</span>
<span id="cb84-394"><a href="#cb84-394" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Hourly temperatures from NYC in 2013"</span>)</span>
<span id="cb84-395"><a href="#cb84-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-396"><a href="#cb84-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-397"><a href="#cb84-397" aria-hidden="true" tabindex="-1"></a>Here, we have given to the boxplot function the formula <span class="in">`temp ~ month`</span>, which basically means we would like boxplots of hourly temperature (<span class="in">`temp`</span>) separately for each <span class="in">`month`</span>. Note, we also have to specify that <span class="in">`temp`</span> and <span class="in">`month`</span> come from the <span class="in">`weather`</span> data set. After splitting the hourly temperatures by month, we now see points extending beyond the whiskers of the boxplots. These are known as *outliers*, and may be thought of as unusually small or large values. However, the definition of an outlier here is somewhat arbitrary as they are defined by the length of the whiskers, which are no more than 1.5 x *IQR*.</span>
<span id="cb84-398"><a href="#cb84-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-399"><a href="#cb84-399" aria-hidden="true" tabindex="-1"></a>Finally, lets make the boxplot more informative by renaming the labels for each of the boxplots:</span>
<span id="cb84-400"><a href="#cb84-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-403"><a href="#cb84-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-404"><a href="#cb84-404" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(temp <span class="sc">~</span> month, <span class="at">data =</span> weather, <span class="at">ylab =</span> <span class="st">"Hourly Temperature"</span>,</span>
<span id="cb84-405"><a href="#cb84-405" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Hourly temperatures from NYC in 2013"</span>, <span class="at">xlab =</span> <span class="st">"Month"</span>,</span>
<span id="cb84-406"><a href="#cb84-406" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb84-407"><a href="#cb84-407" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>))</span>
<span id="cb84-408"><a href="#cb84-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-409"><a href="#cb84-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-410"><a href="#cb84-410" aria-hidden="true" tabindex="-1"></a>How does the hourly temperature change throughout the year?</span>
<span id="cb84-411"><a href="#cb84-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-412"><a href="#cb84-412" aria-hidden="true" tabindex="-1"></a><span class="fu">### Boxplots using `ggplot`</span></span>
<span id="cb84-413"><a href="#cb84-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-414"><a href="#cb84-414" aria-hidden="true" tabindex="-1"></a>To create boxplots using <span class="in">`ggplot`</span> we use the <span class="in">`geom_boxplot()`</span> function. If we want to look at boxplots of a variable separately for a categorical variable then we need to introduce the <span class="in">`factor()`</span> function. This converts a numerical variable into a categorical one, essentially creating labels or categories from the numeric values. For example, the <span class="in">`month`</span> variable within the <span class="in">`weather`</span> data set is a numerical variable taking on the values 1,,12, for each month. However, it makes more sense to convert this into a categorical variable using the <span class="in">`factor()`</span> function, such that:</span>
<span id="cb84-415"><a href="#cb84-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-418"><a href="#cb84-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-419"><a href="#cb84-419" aria-hidden="true" tabindex="-1"></a><span class="co">#weather$month</span></span>
<span id="cb84-420"><a href="#cb84-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-421"><a href="#cb84-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-422"><a href="#cb84-422" aria-hidden="true" tabindex="-1"></a>becomes</span>
<span id="cb84-423"><a href="#cb84-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-426"><a href="#cb84-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-427"><a href="#cb84-427" aria-hidden="true" tabindex="-1"></a><span class="co">#factor(weather$month)</span></span>
<span id="cb84-428"><a href="#cb84-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-429"><a href="#cb84-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-430"><a href="#cb84-430" aria-hidden="true" tabindex="-1"></a>with levels, or categories, 1,,12 for each month. Hence, the boxplots can be produced using <span class="in">`ggplot`</span> as follows:</span>
<span id="cb84-431"><a href="#cb84-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-434"><a href="#cb84-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-435"><a href="#cb84-435" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> weather, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(month), <span class="at">y =</span> temp)) <span class="sc">+</span></span>
<span id="cb84-436"><a href="#cb84-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb84-437"><a href="#cb84-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month"</span>, <span class="at">y =</span> <span class="st">"Temperature (Hourly)"</span>,</span>
<span id="cb84-438"><a href="#cb84-438" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Hourly temperatures from NYC in 2013 by month"</span>)  <span class="sc">+</span></span>
<span id="cb84-439"><a href="#cb84-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb84-440"><a href="#cb84-440" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>))</span>
<span id="cb84-441"><a href="#cb84-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-442"><a href="#cb84-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-443"><a href="#cb84-443" aria-hidden="true" tabindex="-1"></a>Note, we have introduced a new function <span class="in">`scale_x_discrete()`</span>, which is used to rename the labels of the boxplots. This function is used as our categorical variables are discrete in nature.</span>
<span id="cb84-444"><a href="#cb84-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-445"><a href="#cb84-445" aria-hidden="true" tabindex="-1"></a>Before moving on, consider the following questions:</span>
<span id="cb84-446"><a href="#cb84-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-447"><a href="#cb84-447" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Which months have the highest variability in temperature?</span>
<span id="cb84-448"><a href="#cb84-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-449"><a href="#cb84-449" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Are there any values that stick out?</span>
<span id="cb84-450"><a href="#cb84-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-451"><a href="#cb84-451" aria-hidden="true" tabindex="-1"></a><span class="fu">## Barplots</span></span>
<span id="cb84-452"><a href="#cb84-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-453"><a href="#cb84-453" aria-hidden="true" tabindex="-1"></a>Barplots, or barcharts, are used to visualize the distributions of categorical variables. This essentially provides us with the frequencies of categories within a categorical variable. Lets take a look at the distribution of airline carriers within the <span class="in">`flights`</span> data that flew out of New York City in 2013. We can do this by creating a table containing the number of flights from each airline carrier as follows:</span>
<span id="cb84-454"><a href="#cb84-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-457"><a href="#cb84-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-458"><a href="#cb84-458" aria-hidden="true" tabindex="-1"></a>carrier.freq <span class="ot">&lt;-</span> <span class="fu">table</span>(flights<span class="sc">$</span>carrier)</span>
<span id="cb84-459"><a href="#cb84-459" aria-hidden="true" tabindex="-1"></a>carrier.freq</span>
<span id="cb84-460"><a href="#cb84-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-461"><a href="#cb84-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-462"><a href="#cb84-462" aria-hidden="true" tabindex="-1"></a>Turning the above into a barplot provides an easier visualisation of the information provided by the table, and is done as follows:</span>
<span id="cb84-463"><a href="#cb84-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-466"><a href="#cb84-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-467"><a href="#cb84-467" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(carrier.freq)</span>
<span id="cb84-468"><a href="#cb84-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-469"><a href="#cb84-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-470"><a href="#cb84-470" aria-hidden="true" tabindex="-1"></a>Note, the names of the airlines relating to the carrier codes can be found by typing <span class="in">`airlines`</span> into the R console. Using this information and the barplot, find the name of the airline which had the most flights out of New York City in 2013?</span>
<span id="cb84-471"><a href="#cb84-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-472"><a href="#cb84-472" aria-hidden="true" tabindex="-1"></a>Barplots can also be used to compare two categorical variables. For instance, lets say we wanted to look at the number of flights that flew out of New York York in 2013 from each carrier and from each airport (LGA, JFK and EWR). To obtain a table of this information we simply include the flights origin to our previous table as follows:</span>
<span id="cb84-473"><a href="#cb84-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-476"><a href="#cb84-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-477"><a href="#cb84-477" aria-hidden="true" tabindex="-1"></a>carrier.origin <span class="ot">&lt;-</span> <span class="fu">table</span>(flights<span class="sc">$</span>origin, flights<span class="sc">$</span>carrier)</span>
<span id="cb84-478"><a href="#cb84-478" aria-hidden="true" tabindex="-1"></a>carrier.origin</span>
<span id="cb84-479"><a href="#cb84-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-480"><a href="#cb84-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-481"><a href="#cb84-481" aria-hidden="true" tabindex="-1"></a>To turn this information into a barplot we use the same method as before:</span>
<span id="cb84-482"><a href="#cb84-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-485"><a href="#cb84-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-486"><a href="#cb84-486" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(carrier.origin, <span class="at">legend.text =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-487"><a href="#cb84-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-488"><a href="#cb84-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-489"><a href="#cb84-489" aria-hidden="true" tabindex="-1"></a>where the additional argument <span class="in">`legend.text=TRUE`</span> includes the legend highlighting the three airports. This is what is referred to as a *Stacked barplot* since the bars for each <span class="in">`origin`</span> are simply stacked on top of one another for each of the carriers. Which origin did JetBlue Airways appear to favour in 2013?</span>
<span id="cb84-490"><a href="#cb84-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-491"><a href="#cb84-491" aria-hidden="true" tabindex="-1"></a><span class="fu">### Barplots using `ggplot`</span></span>
<span id="cb84-492"><a href="#cb84-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-493"><a href="#cb84-493" aria-hidden="true" tabindex="-1"></a>To create barplots using <span class="in">`ggplot`</span> we use the <span class="in">`geom_col()`</span> function. However, as mentioned earlier, <span class="in">`ggplot`</span> expects the data passed to it to be a data frame, and so we will first transform our previous tables into data frames as follows:</span>
<span id="cb84-494"><a href="#cb84-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-497"><a href="#cb84-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-498"><a href="#cb84-498" aria-hidden="true" tabindex="-1"></a>carrier.freq <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(carrier.freq)</span>
<span id="cb84-499"><a href="#cb84-499" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(carrier.freq) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"carrier"</span>, <span class="st">"number"</span>)</span>
<span id="cb84-500"><a href="#cb84-500" aria-hidden="true" tabindex="-1"></a>carrier.origin <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(carrier.origin)</span>
<span id="cb84-501"><a href="#cb84-501" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(carrier.origin) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"origin"</span>, <span class="st">"carrier"</span>, <span class="st">"number"</span>)</span>
<span id="cb84-502"><a href="#cb84-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-503"><a href="#cb84-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-504"><a href="#cb84-504" aria-hidden="true" tabindex="-1"></a>The names of the columns in our data frames have also been updated using the <span class="in">`colnames()`</span> function. Take a look at your new data frames within the R console. First, lets plot the data relating to the carriers who flew out of New York City in 2013. This is done using the following code:</span>
<span id="cb84-505"><a href="#cb84-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-508"><a href="#cb84-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-509"><a href="#cb84-509" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> carrier.freq, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> number)) <span class="sc">+</span></span>
<span id="cb84-510"><a href="#cb84-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span>
<span id="cb84-511"><a href="#cb84-511" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-512"><a href="#cb84-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-513"><a href="#cb84-513" aria-hidden="true" tabindex="-1"></a>Add to the code above to give your barplot new labels and a title similar to the one displayed in the notes.</span>
<span id="cb84-514"><a href="#cb84-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-515"><a href="#cb84-515" aria-hidden="true" tabindex="-1"></a>The barplot for comparing two categorical vairables is very similar in this case, where we simply pass the additional <span class="in">`fill`</span> argument to the <span class="in">`aes()`</span> function. Including the <span class="in">`fill`</span> argument lets <span class="in">`ggplot`</span> plot know that we want to split the barplot according to an additional categorical variable, which is <span class="in">`origin`</span> in this case. The barplot is then given by:</span>
<span id="cb84-516"><a href="#cb84-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-519"><a href="#cb84-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-520"><a href="#cb84-520" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> carrier.origin, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> number, <span class="at">fill =</span> origin)) <span class="sc">+</span></span>
<span id="cb84-521"><a href="#cb84-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb84-522"><a href="#cb84-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Carrier"</span>, <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb84-523"><a href="#cb84-523" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Carriers who flew out of New York City in 2013"</span>) </span>
<span id="cb84-524"><a href="#cb84-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-525"><a href="#cb84-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-526"><a href="#cb84-526" aria-hidden="true" tabindex="-1"></a>This provides us with a visually nice barplot to present our carrier information by airport of origin. However, there are also alternative barplots to the stacked barplot. One alternative to a stacked barplot is the **side-by-side** (or **dodged**) **barplot**, which, as suggested by its name, places the bars next to each another instead of on top of one another. This can be produced as follows:</span>
<span id="cb84-527"><a href="#cb84-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-530"><a href="#cb84-530" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-531"><a href="#cb84-531" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> carrier.origin, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> number, <span class="at">fill =</span> origin)) <span class="sc">+</span></span>
<span id="cb84-532"><a href="#cb84-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb84-533"><a href="#cb84-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Carrier"</span>, <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb84-534"><a href="#cb84-534" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Carriers who flew out of New York City in 2013"</span>) </span>
<span id="cb84-535"><a href="#cb84-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-536"><a href="#cb84-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-537"><a href="#cb84-537" aria-hidden="true" tabindex="-1"></a>This is done by passing to the <span class="in">`geom_col()`</span> function the <span class="in">`position`</span> of the barplots, which in this case is <span class="in">`dodged`</span>. Before moving on, consider the following two questions:</span>
<span id="cb84-538"><a href="#cb84-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-539"><a href="#cb84-539" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What could be considered a positive of using a side-by-side barplot as opposed to a stacked barplot?</span>
<span id="cb84-540"><a href="#cb84-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-541"><a href="#cb84-541" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What could be a disadvantage of using a side-by-side barplot?</span>
<span id="cb84-542"><a href="#cb84-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-543"><a href="#cb84-543" aria-hidden="true" tabindex="-1"></a>Lastly, lets take a look at what is referred to as a **faceted barplot**. They provide an easier way to compare the carrier distributions by origin, and can be obtained as follows:</span>
<span id="cb84-544"><a href="#cb84-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-547"><a href="#cb84-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-548"><a href="#cb84-548" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> carrier.origin, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> carrier, <span class="at">y =</span> number, <span class="at">fill =</span> origin)) <span class="sc">+</span></span>
<span id="cb84-549"><a href="#cb84-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb84-550"><a href="#cb84-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> origin, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb84-551"><a href="#cb84-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Carrier"</span>, <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb84-552"><a href="#cb84-552" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Carriers who flew out of New York City in 2013"</span>) </span>
<span id="cb84-553"><a href="#cb84-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-554"><a href="#cb84-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-555"><a href="#cb84-555" aria-hidden="true" tabindex="-1"></a>Here we include the <span class="in">`facet_wrap()`</span> function, where we want separate barplots by <span class="in">`origin`</span>, and hence we use <span class="in">`~ origin`</span>. We also choose to have them plotted in one column via <span class="in">`ncol = 1`</span>. This makes it easier to compare their distributions now that they are not stacked on top or beside one another.</span>
<span id="cb84-556"><a href="#cb84-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-557"><a href="#cb84-557" aria-hidden="true" tabindex="-1"></a>Before moving on to the next section, consider the following questions:</span>
<span id="cb84-558"><a href="#cb84-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-559"><a href="#cb84-559" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the difference between histograms and barplots?</span>
<span id="cb84-560"><a href="#cb84-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-561"><a href="#cb84-561" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why can't we use histograms to visualize categorical variables?</span>
<span id="cb84-562"><a href="#cb84-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-563"><a href="#cb84-563" aria-hidden="true" tabindex="-1"></a><span class="fu">## Linegraphs</span></span>
<span id="cb84-564"><a href="#cb84-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-565"><a href="#cb84-565" aria-hidden="true" tabindex="-1"></a>Linegraphs are typically used when looking at *time series* data, that is, when we have information on how a variable changes over time. Hence, there is a natural ordering to the data when observing how something changes over time, and therefore, linegraphs should be avoided if there is no sequential ordering of a variable. Lets again look at the hourly temperature data, but this time only for Newark Inernational Airport in January. This can be done by first subsetting the data as follows:</span>
<span id="cb84-566"><a href="#cb84-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-569"><a href="#cb84-569" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-570"><a href="#cb84-570" aria-hidden="true" tabindex="-1"></a>Newark.Jan <span class="ot">&lt;-</span> weather[weather<span class="sc">$</span>origin <span class="sc">==</span> <span class="st">"EWR"</span> <span class="sc">&amp;</span> weather<span class="sc">$</span>month <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb84-571"><a href="#cb84-571" aria-hidden="true" tabindex="-1"></a>Newark.Jan</span>
<span id="cb84-572"><a href="#cb84-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-573"><a href="#cb84-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-574"><a href="#cb84-574" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb84-575"><a href="#cb84-575" aria-hidden="true" tabindex="-1"></a>Take a look at the new data set for hourly temperatures at Newark International Airport in January using functions metioned earlier. We can now produce a linegraph of the hourly temperature as follows:</span>
<span id="cb84-576"><a href="#cb84-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-579"><a href="#cb84-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-580"><a href="#cb84-580" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Newark.Jan<span class="sc">$</span>time_hour, Newark.Jan<span class="sc">$</span>temp, <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb84-581"><a href="#cb84-581" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time (Hours)"</span>, <span class="at">ylab =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb84-582"><a href="#cb84-582" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Hourly Temperature at Newark Airport in January 2013"</span>)</span>
<span id="cb84-583"><a href="#cb84-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-584"><a href="#cb84-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-585"><a href="#cb84-585" aria-hidden="true" tabindex="-1"></a>Here, we have passed to the <span class="in">`plot()`</span> function the additional <span class="in">`type=l`</span> argument, indicating that we would like a linegraph to be produced. By default, the <span class="in">`plot()`</span> function plots the data as points. Before moving on, consider the following questions:</span>
<span id="cb84-586"><a href="#cb84-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-587"><a href="#cb84-587" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In the code for the linegraph above, why has <span class="in">`time_hour`</span> been plotted on the x-axis and not <span class="in">`hour`</span>?</span>
<span id="cb84-588"><a href="#cb84-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-589"><a href="#cb84-589" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why are linegraphs frequently used when time is the explanatory variable?</span>
<span id="cb84-590"><a href="#cb84-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-591"><a href="#cb84-591" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linegraphs using `ggplot`</span></span>
<span id="cb84-592"><a href="#cb84-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-593"><a href="#cb84-593" aria-hidden="true" tabindex="-1"></a>To produce linegraphs using <span class="in">`ggplot`</span> we use the <span class="in">`geom_line()`</span> command. Hence, our linegraph for the hourly temperatures at Newark International Airport in January 2013 can be created as follows:</span>
<span id="cb84-594"><a href="#cb84-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-597"><a href="#cb84-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-598"><a href="#cb84-598" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Newark.Jan, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> time_hour, <span class="at">y =</span> temp)) <span class="sc">+</span></span>
<span id="cb84-599"><a href="#cb84-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb84-600"><a href="#cb84-600" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time (Hours)"</span>, <span class="at">y =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb84-601"><a href="#cb84-601" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Hourly Temperature at Newark Airport in January 2013"</span>) </span>
<span id="cb84-602"><a href="#cb84-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-603"><a href="#cb84-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-604"><a href="#cb84-604" aria-hidden="true" tabindex="-1"></a>Before moving on to the next section, consider the following:</span>
<span id="cb84-605"><a href="#cb84-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-606"><a href="#cb84-606" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why should linegraphs be avoided when there is no sequential ordering of the data?</span>
<span id="cb84-607"><a href="#cb84-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-608"><a href="#cb84-608" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why are linegraphs used when time is the explanatory variable?</span>
<span id="cb84-609"><a href="#cb84-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-610"><a href="#cb84-610" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Describe the trend in hourly temperature at Newark International Airport in January 2013.</span>
<span id="cb84-611"><a href="#cb84-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-612"><a href="#cb84-612" aria-hidden="true" tabindex="-1"></a>Now we're ready to visualize this information. First let's make a plot of the United States, as it seems the flights only include flights to other American cities. We use the map data included with the <span class="in">`ggplot2`</span> package, and we we set the variable <span class="in">`states`</span> to the dataframe that includes the coordinates to plot each state. We then use <span class="in">`geom_polygon`</span> in order to plot the map using the coordinate information.</span>
<span id="cb84-613"><a href="#cb84-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-616"><a href="#cb84-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-617"><a href="#cb84-617" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-618"><a href="#cb84-618" aria-hidden="true" tabindex="-1"></a>states <span class="ot">=</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb84-619"><a href="#cb84-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-620"><a href="#cb84-620" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>states)</span>
<span id="cb84-621"><a href="#cb84-621" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> g <span class="sc">+</span> <span class="fu">geom_polygon</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>long,<span class="at">y=</span>lat,<span class="at">group=</span>group),<span class="at">color=</span><span class="st">"white"</span>,<span class="at">fill=</span><span class="st">"grey"</span>)</span>
<span id="cb84-622"><a href="#cb84-622" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> g2 <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Map of the USA minus Alaska"</span>)</span>
<span id="cb84-623"><a href="#cb84-623" aria-hidden="true" tabindex="-1"></a>g2</span>
<span id="cb84-624"><a href="#cb84-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-625"><a href="#cb84-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-626"><a href="#cb84-626" aria-hidden="true" tabindex="-1"></a>Let's now add the information regarding which destination airports are the cause of most delay. Let's remove the points that are too west to be plotted onto this map, (ie: all airports in Alaska).</span>
<span id="cb84-627"><a href="#cb84-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-630"><a href="#cb84-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-631"><a href="#cb84-631" aria-hidden="true" tabindex="-1"></a>flights3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights2, lon <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">140</span>)</span>
<span id="cb84-632"><a href="#cb84-632" aria-hidden="true" tabindex="-1"></a>g3 <span class="ot">&lt;-</span> g2 <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data=</span>flights3, </span>
<span id="cb84-633"><a href="#cb84-633" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">color =</span> avg_delay), </span>
<span id="cb84-634"><a href="#cb84-634" aria-hidden="true" tabindex="-1"></a>                      <span class="at">position =</span> <span class="st">"jitter"</span>,<span class="at">size=</span><span class="fl">2.5</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Average Delay"</span>) <span class="sc">+</span> <span class="fu">scale_colour_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>,<span class="at">high =</span> <span class="st">"dark red"</span>)</span>
<span id="cb84-635"><a href="#cb84-635" aria-hidden="true" tabindex="-1"></a>g3</span>
<span id="cb84-636"><a href="#cb84-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-637"><a href="#cb84-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-638"><a href="#cb84-638" aria-hidden="true" tabindex="-1"></a>Let's make this even more detailed by adding some labels to the worst, and best destinations.</span>
<span id="cb84-639"><a href="#cb84-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-642"><a href="#cb84-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-643"><a href="#cb84-643" aria-hidden="true" tabindex="-1"></a><span class="co">#let's remove the na terms, because they will cause some trouble for the tail function later on.</span></span>
<span id="cb84-644"><a href="#cb84-644" aria-hidden="true" tabindex="-1"></a><span class="co">#note: probably should've removed the na terms far earlier on.</span></span>
<span id="cb84-645"><a href="#cb84-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-646"><a href="#cb84-646" aria-hidden="true" tabindex="-1"></a>flights3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights3, <span class="sc">!</span><span class="fu">is.na</span>(avg_delay))</span>
<span id="cb84-647"><a href="#cb84-647" aria-hidden="true" tabindex="-1"></a>worst_flights <span class="ot">&lt;-</span> <span class="fu">head</span>(flights3,<span class="dv">5</span>)</span>
<span id="cb84-648"><a href="#cb84-648" aria-hidden="true" tabindex="-1"></a>best_flights <span class="ot">&lt;-</span> <span class="fu">tail</span>(flights3,<span class="dv">5</span>)</span>
<span id="cb84-649"><a href="#cb84-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-650"><a href="#cb84-650" aria-hidden="true" tabindex="-1"></a>g4 <span class="ot">&lt;-</span> g3 <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">data=</span>worst_flights, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">label =</span> dest), <span class="at">color=</span><span class="st">"red"</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.5</span>) </span>
<span id="cb84-651"><a href="#cb84-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-652"><a href="#cb84-652" aria-hidden="true" tabindex="-1"></a>g4 <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">data=</span>best_flights, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat , <span class="at">label =</span> dest), <span class="at">angle=</span><span class="dv">20</span>,<span class="at">nudge_y=</span><span class="sc">-</span><span class="fl">0.5</span>)</span>
<span id="cb84-653"><a href="#cb84-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-654"><a href="#cb84-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-655"><a href="#cb84-655" aria-hidden="true" tabindex="-1"></a>As an added bonus, we'll plot this information(including those points too Western for the ggplot map of the USA) using <span class="in">`plotly`</span>.</span>
<span id="cb84-656"><a href="#cb84-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-659"><a href="#cb84-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-660"><a href="#cb84-660" aria-hidden="true" tabindex="-1"></a><span class="co">#flights2$hover &lt;- with(flights2, paste0(name,', Avg. Delay: '#,avg_delay))</span></span>
<span id="cb84-661"><a href="#cb84-661" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb84-662"><a href="#cb84-662" aria-hidden="true" tabindex="-1"></a><span class="co">#m &lt;- list(</span></span>
<span id="cb84-663"><a href="#cb84-663" aria-hidden="true" tabindex="-1"></a><span class="co">#  colorbar = list(title = "Average Delay"),</span></span>
<span id="cb84-664"><a href="#cb84-664" aria-hidden="true" tabindex="-1"></a><span class="co">#  size = 9, opacity = 0.7, symbol = 'circle'</span></span>
<span id="cb84-665"><a href="#cb84-665" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb84-666"><a href="#cb84-666" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb84-667"><a href="#cb84-667" aria-hidden="true" tabindex="-1"></a><span class="do">## geo styling</span></span>
<span id="cb84-668"><a href="#cb84-668" aria-hidden="true" tabindex="-1"></a><span class="co">#g &lt;- list(</span></span>
<span id="cb84-669"><a href="#cb84-669" aria-hidden="true" tabindex="-1"></a><span class="co">#  scope = 'usa',</span></span>
<span id="cb84-670"><a href="#cb84-670" aria-hidden="true" tabindex="-1"></a><span class="co">#  projection = list(type = 'albers usa'),</span></span>
<span id="cb84-671"><a href="#cb84-671" aria-hidden="true" tabindex="-1"></a><span class="co">#  showland = TRUE,</span></span>
<span id="cb84-672"><a href="#cb84-672" aria-hidden="true" tabindex="-1"></a><span class="co">#  landcolor = toRGB("gray95"),</span></span>
<span id="cb84-673"><a href="#cb84-673" aria-hidden="true" tabindex="-1"></a><span class="co">#  subunitcolor = toRGB("gray85"),</span></span>
<span id="cb84-674"><a href="#cb84-674" aria-hidden="true" tabindex="-1"></a><span class="co">#  countrycolor = toRGB("gray85"),</span></span>
<span id="cb84-675"><a href="#cb84-675" aria-hidden="true" tabindex="-1"></a><span class="co">#  countrywidth = 1,</span></span>
<span id="cb84-676"><a href="#cb84-676" aria-hidden="true" tabindex="-1"></a><span class="co">#  subunitwidth = 0.5</span></span>
<span id="cb84-677"><a href="#cb84-677" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb84-678"><a href="#cb84-678" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb84-679"><a href="#cb84-679" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb84-680"><a href="#cb84-680" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb84-681"><a href="#cb84-681" aria-hidden="true" tabindex="-1"></a><span class="co">#usa &lt;- plot_ly(flights2, lat = lat, lon = lon, text = hover, color = #avg_delay,</span></span>
<span id="cb84-682"><a href="#cb84-682" aria-hidden="true" tabindex="-1"></a><span class="co">#        type = 'scattergeo', locationmode = 'USA-states', mode = #'markers',</span></span>
<span id="cb84-683"><a href="#cb84-683" aria-hidden="true" tabindex="-1"></a><span class="co">#        marker = m) %&gt;% layout(title = 'Delays of US airports, #flying out of NYC', geo = g)</span></span>
<span id="cb84-684"><a href="#cb84-684" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb84-685"><a href="#cb84-685" aria-hidden="true" tabindex="-1"></a><span class="co">#usa</span></span>
<span id="cb84-686"><a href="#cb84-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-687"><a href="#cb84-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-688"><a href="#cb84-688" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Second Question now is:</span></span>
<span id="cb84-689"><a href="#cb84-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-690"><a href="#cb84-690" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is there a relationship between the age of a plane and its delays?</span>
<span id="cb84-691"><a href="#cb84-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-692"><a href="#cb84-692" aria-hidden="true" tabindex="-1"></a>So for this we are using the year the plane is made as a proxy for age, ie: latest models are the youngest planes. Answering this question now requires us to join the <span class="in">`planes`</span> table with the flights table in a similar fashion as we did before:</span>
<span id="cb84-693"><a href="#cb84-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-696"><a href="#cb84-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-697"><a href="#cb84-697" aria-hidden="true" tabindex="-1"></a>flights_planes <span class="ot">&lt;-</span> <span class="fu">mutate</span>(flights, <span class="at">tot_delay =</span> arr_delay <span class="sc">+</span> dep_delay)</span>
<span id="cb84-698"><a href="#cb84-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-699"><a href="#cb84-699" aria-hidden="true" tabindex="-1"></a>flights_planes <span class="ot">&lt;-</span> flights_planes <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(tailnum) <span class="sc">%&gt;%</span> </span>
<span id="cb84-700"><a href="#cb84-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_delay =</span> <span class="fu">mean</span>(tot_delay, <span class="at">na.rm =</span> T), <span class="at">num_of_flights =</span> <span class="fu">n</span>() ) <span class="sc">%&gt;%</span> </span>
<span id="cb84-701"><a href="#cb84-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes, <span class="at">by=</span><span class="st">"tailnum"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-702"><a href="#cb84-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_delay))</span>
<span id="cb84-703"><a href="#cb84-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-704"><a href="#cb84-704" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(flights_planes)</span>
<span id="cb84-705"><a href="#cb84-705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-706"><a href="#cb84-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-709"><a href="#cb84-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-710"><a href="#cb84-710" aria-hidden="true" tabindex="-1"></a><span class="co">#let's remove all the planes that haven't flown more than 100 times, and any missing values.</span></span>
<span id="cb84-711"><a href="#cb84-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-712"><a href="#cb84-712" aria-hidden="true" tabindex="-1"></a>flights_planes2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights_planes, num_of_flights<span class="sc">&gt;=</span><span class="dv">100</span>, <span class="sc">!</span><span class="fu">is.na</span>(avg_delay), <span class="sc">!</span><span class="fu">is.na</span>(year))</span>
<span id="cb84-713"><a href="#cb84-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-714"><a href="#cb84-714" aria-hidden="true" tabindex="-1"></a>g_planes <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()</span>
<span id="cb84-715"><a href="#cb84-715" aria-hidden="true" tabindex="-1"></a>g_planes <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">data=</span>flights_planes2, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>avg_delay)) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">data=</span>flights_planes2, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>avg_delay), <span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Average Delay"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Year of Plane vs Average Delay"</span>) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">data=</span>flights_planes2, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>avg_delay), <span class="at">color=</span><span class="st">"red"</span>, <span class="at">se=</span>F)</span>
<span id="cb84-716"><a href="#cb84-716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-717"><a href="#cb84-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-718"><a href="#cb84-718" aria-hidden="true" tabindex="-1"></a>From the looks of the plot, it doesn't really seem like there's a relationship. The average delay times are all fairly spread out for all the years with a lot of planes, there does seem to be a lot more variation in the early 2000s compared to the years following however.</span>
<span id="cb84-719"><a href="#cb84-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-720"><a href="#cb84-720" aria-hidden="true" tabindex="-1"></a>However I plotted the blue line, which represents a linear model (avg_delay \~ year), and it seems to signal a positive relationship between the two variables. We can further examine the model to see if this is valid.</span>
<span id="cb84-721"><a href="#cb84-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-724"><a href="#cb84-724" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-725"><a href="#cb84-725" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(avg_delay<span class="sc">~</span>year,<span class="at">data=</span>flights_planes2)</span>
<span id="cb84-726"><a href="#cb84-726" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb84-727"><a href="#cb84-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-728"><a href="#cb84-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-729"><a href="#cb84-729" aria-hidden="true" tabindex="-1"></a>We see that the p-value for the coefficient for year is actually significant, and is equal to <span class="in">`0.16929`</span>, which is again quite negligile in practical terms. In addition, the r-squared of the model is: <span class="in">`summary(model)$r.squared`</span> which indicates an extremely poor model, and thus it's evidence against a linear relationship between year of the plane and average delay. In addition we also tried a polynomial model(indicated in red), but that returned a poor r-squared as well. Thus I don't believe that there's a practical relationship between the age of the plane the delays they face, at least for the data that is present in the nycflights13 dataset.</span>
<span id="cb84-730"><a href="#cb84-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-731"><a href="#cb84-731" aria-hidden="true" tabindex="-1"></a><span class="fu">### Conclusion</span></span>
<span id="cb84-732"><a href="#cb84-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-733"><a href="#cb84-733" aria-hidden="true" tabindex="-1"></a>In this post we used <span class="in">`join functions`</span> in the <span class="in">`dplyr`</span> package in order to generate new data frames for our analysis. We were able to use this information to visualize delays by airports via a map of the USA, and we were able to answer the question of whether or not the age of the plane had an influence of the average delay time of the plane.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">©LS</div>
  </div>
</footer>



</body></html>